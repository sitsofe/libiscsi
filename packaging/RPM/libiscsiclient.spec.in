Name: libiscsiclient
Summary: iSCSI client library
Version: 2.0.0
Release: 1GITHASH%{?dist}
License: LGPLv2+
Group: System Environment/Libraries
URL: https://github.com/sahlberg/libiscsi

Source: libiscsiclient-%{version}.tar.gz

BuildRoot: %{_tmppath}/%{name}-%{version}-root
BuildRequires: autoconf
BuildRequires: automake
BuildRequires: libtool
BuildRequires: popt-devel

%description
libiscsiclient is a library for attaching to iSCSI resources across
a network.


#######################################################################



%prep
%setup -q
# setup the init script and sysconfig file
%setup -T -D -n libiscsiclient-%{version} -q

%build

CC="gcc"

export CC

## always run autogen.sh
./autogen.sh
%configure
make %{?_smp_mflags}

%install
# Clean up in case there is trash left from a previous build
rm -rf $RPM_BUILD_ROOT
make DESTDIR=$RPM_BUILD_ROOT install %{?_smp_mflags}
rm $RPM_BUILD_ROOT/%{_libdir}/libiscsiclient.a
rm $RPM_BUILD_ROOT/%{_libdir}/libiscsiclient.la

# Remove "*.old" files
find $RPM_BUILD_ROOT -name "*.old" -exec rm -f {} \;

%clean
rm -rf $RPM_BUILD_ROOT

%post -p /sbin/ldconfig

%postun -p /sbin/ldconfig

%files
%defattr(-,root,root)
%doc COPYING.LESSER README TODO
%{_libdir}/libiscsiclient.so.*

%package utils
Summary: iSCSI Client Utilities
Group: Applications/System

%description utils
The libiscsiclient-utils package provides a set of assorted utilities to connect
to iSCSI servers without having to set up the Linux iSCSI initiator.

%files utils
%doc COPYING README TODO
%{_bindir}/ld_iscsi.so
%{_bindir}/iscsi-ls
%{_bindir}/iscsi-inq

%package devel
Summary: iSCSI client development libraries
Group: Development/Libraries
Requires: libiscsiclient = %{version}-%{release}

%description devel
The libiscsiclient-devel package includes the header files for libiscsiclient.

%files devel
%defattr(-,root,root)
%doc COPYING.LESSER README TODO
%{_includedir}/iscsi/iscsi.h
%{_includedir}/iscsi/scsi-lowlevel.h
%{_libdir}/libiscsiclient.so

%changelog
* Sat Mar 3 2012 : 2.0.0
 - Rename to libiscsiclient to avoid collission with obscure linux library
* Sun Dec 25 2011 : 1.1.0
- Fix TaskManagement AbortTask/AbortTaskSet to send to correct LUN

* Fri Oct 28 2011 Paolo Bonzini <pbonzini@redhat.com> - 1.0.0-2
- Fixed rpmlint problems

* Sat Dec 4 2010 Ronnie Sahlberg <ronniesahlberg@gmail.com> - 1.0.0-1
- Initial version
